
$username = $password = $confirmPassword = "";
$oldUsername = $oldPassword = "";
$confirm_password_err = "";

require_once("config.php");

if (isset($_POST['submit'])) {
    $id = $_GET['id'];
    $query = "SELECT * FROM customers WHERE customerID = $id";
    $result = mysqli_query($link, $query);
    $row = mysqli_fetch_assoc($result);
    $oldUsername = $row['customerUsername'];
    $oldPassword = $row['customerPassword'];

    $username = trim($_POST['username']);
    $password = trim($_POST['password']);
    $confirmPassword = trim($_POST['confirmPassword']);

    if (empty($username)) {
        $username = $oldUsername;
    }
    if (empty($password)) {
        $password = $oldPassword;
    }
    if ($password != $confirmPassword) {
        $confirm_password_err = '<span style ="color:#f44242;text-align:left;font-size:15px">Password did not match</span>';
    } else {
        $param_username = $username;
        $param_password = password_hash($password, PASSWORD_DEFAULT);
        $sql = "UPDATE customers SET customerUsername = '$param_username', customerPassword = '$param_password' WHERE customerID = $id;";
        $stmt = mysqli_prepare($link, $sql);
        if(mysqli_stmt_execute($stmt)){
            header("location: adminDashboard.php");
        } else {
            echo "Unable to update customer records.";
        }
        // Close statement
        mysqli_stmt_close($stmt);
    }

// Close connection
mysqli_close($link);